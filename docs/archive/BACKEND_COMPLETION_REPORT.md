# π‰ λ°±μ—”λ“ κ°λ° μ™„λ£ λ³΄κ³ μ„

> **μ½”λ”©λ©”μ΄μ»¤ ν•™μ› ν†µν•© κ΄€λ¦¬ μ‹μ¤ν…**  
> **μ‘μ„±μΌ**: 2024-11-20  
> **λ²„μ „**: 1.0.0

---

## π“ ν”„λ΅μ νΈ ν„ν™©

### β… μ™„λ£λ μ‘μ—…

#### 1. **ν”„λ΅μ νΈ μΈν”„λΌ**
- β… TypeScript + Express + Prisma κΈ°λ° λ°±μ—”λ“ κµ¬μ΅°
- β… ES Module λ°©μ‹ μ μ©
- β… κ°λ° ν™κ²½ μ„¤μ • (tsx, hot reload)
- β… ν™κ²½ λ³€μ κ΄€λ¦¬ (.env)
- β… Git λ¬΄μ‹ νμΌ μ„¤μ •

#### 2. **λ°μ΄ν„°λ² μ΄μ¤**
- β… Prisma μ¤ν‚¤λ§ μ™„μ„± (11κ° λ¨λΈ)
  - User, Attendance, Post, Comment, PostLike, CommentLike
  - ChatRoom, Message, Friendship, Course, UserCourse, AcademyInfo, AuditLog
- β… SQLite κ°λ° DB κµ¬μ¶•
- β… λ§μ΄κ·Έλ μ΄μ… μ‹μ¤ν…
- β… Seed μ¤ν¬λ¦½νΈ (μ΄κΈ° λ°μ΄ν„°)
  - κ΄€λ¦¬μ κ³„μ • (admin/admin1234)
  - ν•™μ› μ •λ³΄ 6κ° ν•­λ©
  - κΈ°λ³Έ μ»¤λ¦¬νλΌ 3κ°

#### 3. **λ³΄μ• μ‹μ¤ν…**
- β… **AES-256-CBC μ•”νΈν™”** (Random IV)
  - `crypto.service.ts` - encrypt/decrypt ν•¨μ
  - μ‹¤λ…, μ „ν™”λ²νΈ, μ£Όμ† μλ™ μ•”νΈν™”/λ³µνΈν™”
  - λ§¤ μ•”νΈν™”λ§λ‹¤ μƒλ΅μ΄ IV μƒμ„±
- β… **JWT μΈμ¦**
  - `auth.service.ts` - λ΅κ·ΈμΈ/νμ›κ°€μ…
  - `auth.middleware.ts` - ν† ν° κ²€μ¦
  - 7μΌ λ§λ£ μ„¤μ •
- β… **Tier κΈ°λ° κ¶ν•**
  - `permission.middleware.ts` - requireTier, requireRole
  - 5λ‹¨κ³„ κ¶ν• μ²΄κ³„ (Tier 1~5)
- β… **Rate Limiting**
  - `rateLimit.middleware.ts`
  - μΌλ° API: 15λ¶„/100ν
  - λ΅κ·ΈμΈ: 15λ¶„/5ν
  - μ¶μ„: 1λ¶„/10ν
- β… **μ—λ¬ ν•Έλ“¤λ§**
  - `errorHandler.middleware.ts`
  - κ°λ°/ν”„λ΅λ•μ… ν™κ²½ λ¶„λ¦¬

#### 4. **REST API κµ¬ν„** (21κ° μ—”λ“ν¬μΈνΈ)

##### μΈμ¦ API (`/api/auth`) - 3κ°
- β… `POST /login` - λ΅κ·ΈμΈ (Rate limit)
- β… `POST /register` - νμ›κ°€μ…
- β… `GET /me` - ν„μ¬ μ‚¬μ©μ μ •λ³΄

##### μ¶μ„ API (`/api/attendance`) - 2κ°
- β… `POST /checkin` - νƒκ·Έ κΈ°λ° μ¶μ„ μ²΄ν¬
- β… `GET /user/:userId` - μ¶μ„ λ‚΄μ—­ μ΅°ν (λ³ΈμΈ/κ΄€λ¦¬μ)

##### ν•™μ› μ •λ³΄ API (`/api/academy`) - 2κ°
- β… `GET /info` - ν•™μ› μ •λ³΄ μ΅°ν (κ³µκ°)
- β… `PUT /info` - ν•™μ› μ •λ³΄ μμ • (Tier 1)

##### μ»¤λ¦¬νλΌ API (`/api/courses`) - 4κ°
- β… `GET /` - λ©λ΅ μ΅°ν (μΉ΄ν…κ³ λ¦¬ ν•„ν„°)
- β… `POST /` - μƒμ„± (Tier 1, 2)
- β… `PUT /:id` - μμ • (Tier 1, 2)
- β… `DELETE /:id` - μ‚­μ  (Tier 1)

##### μ»¤λ®¤λ‹ν‹° API (`/api/community`) - 5κ°
- β… `GET /posts` - λ©λ΅ (νμ΄μ§€λ„¤μ΄μ…, μ •λ ¬)
- β… `GET /posts/:id` - μƒμ„Έ (μ΅°νμ μ¦κ°€)
- β… `POST /posts` - μ‘μ„± (Tier 3 μ΄ν•)
- β… `PUT /posts/:id/like` - μ¶”μ²/μ·¨μ†
- β… `POST /posts/:id/comments` - λ“κΈ€ μ‘μ„±

##### μΉκµ¬ μ‹μ¤ν… API (`/api/friends`) - 4κ°
- β… `POST /request` - μΉκµ¬ μ”μ²­
- β… `PUT /:friendshipId/accept` - μ”μ²­ μλ½
- β… `GET /` - μΉκµ¬ λ©λ΅
- β… `DELETE /:friendshipId` - μΉκµ¬ μ‚­μ 

##### μ‚¬μ©μ API (`/api/users`) - 1κ°
- β… `GET /:userId/profile` - ν”„λ΅ν•„ μ΅°ν

---

## π—οΈ ν”„λ΅μ νΈ κµ¬μ΅°

```
backend/
β”β”€β”€ src/
β”‚   β”β”€β”€ app.ts                 # Express μ•± μ„¤μ •
β”‚   β”β”€β”€ server.ts              # μ„λ²„ μ§„μ…μ 
β”‚   β”β”€β”€ config/
β”‚   β”‚   β””β”€β”€ database.ts        # Prisma Client
β”‚   β”β”€β”€ services/
β”‚   β”‚   β”β”€β”€ crypto.service.ts  # AES-256 μ•”νΈν™”
β”‚   β”‚   β””β”€β”€ auth.service.ts    # λ΅κ·ΈμΈ/νμ›κ°€μ…
β”‚   β”β”€β”€ middleware/
β”‚   β”‚   β”β”€β”€ auth.ts            # JWT κ²€μ¦
β”‚   β”‚   β”β”€β”€ permission.ts      # Tier/Role κ¶ν•
β”‚   β”‚   β”β”€β”€ rateLimit.ts       # Rate Limiting
β”‚   β”‚   β””β”€β”€ errorHandler.ts    # μ—λ¬ ν•Έλ“¤λ¬
β”‚   β”β”€β”€ controllers/           # μ”μ²­ μ²λ¦¬ (7κ°)
β”‚   β”β”€β”€ routes/                # API λΌμ°νΈ (7κ°)
β”‚   β””β”€β”€ types/
β”‚       β””β”€β”€ express.d.ts       # TypeScript νƒ€μ…
β”β”€β”€ prisma/
β”‚   β”β”€β”€ schema.prisma          # DB μ¤ν‚¤λ§ (11 λ¨λΈ)
β”‚   β”β”€β”€ seed.ts                # μ΄κΈ° λ°μ΄ν„°
β”‚   β”β”€β”€ dev.db                 # SQLite DB
β”‚   β””β”€β”€ migrations/            # λ§μ΄κ·Έλ μ΄μ…
β”β”€β”€ .env                       # ν™κ²½ λ³€μ
β”β”€β”€ .env.example               # ν™κ²½ λ³€μ μμ‹
β”β”€β”€ package.json               # μμ΅΄μ„± & μ¤ν¬λ¦½νΈ
β”β”€β”€ tsconfig.json              # TypeScript μ„¤μ •
β”β”€β”€ README.md                  # λ°±μ—”λ“ κ°€μ΄λ“
β””β”€β”€ API_TEST_RESULTS.md        # API ν…μ¤νΈ κ²°κ³Ό
```

---

## π§ ν…μ¤νΈ κ²°κ³Ό

### μλ™ν™”λ ν…μ¤νΈ
- β… Health Check μ •μƒ λ™μ‘
- β… λ΅κ·ΈμΈ API μ •μƒ (JWT ν† ν° λ°κΈ‰)
- β… μ¶μ„ μ²΄ν¬ μ •μƒ (μ•”νΈν™” λ³µνΈν™” λ™μ‘)
- β… ν•™μ› μ •λ³΄ μ΅°ν μ •μƒ
- β… μ»¤λ¦¬νλΌ λ©λ΅ μ΅°ν μ •μƒ (3κ° μ΄κΈ° λ°μ΄ν„°)
- β… κ²μ‹κΈ€ μ‘μ„± μ •μƒ

### λ³΄μ• κ²€μ¦
- β… μ•”νΈν™”λ λ°μ΄ν„° DB μ €μ¥ ν™•μΈ
- β… API μ‘λ‹µ μ‹ μλ™ λ³µνΈν™” ν™•μΈ
- β… Random IV λ™μ‘ ν™•μΈ (λ§¤λ² λ‹¤λ¥Έ μ•”νΈλ¬Έ)
- β… JWT ν† ν° κ²€μ¦ μ •μƒ
- β… Tier κ¶ν• μ²΄ν¬ μ •μƒ
- β… Rate Limiting λ™μ‘ ν™•μΈ

---

## π“ μ™„μ„±λ„

| μμ—­ | μ™„μ„±λ„ | λΉ„κ³  |
|------|--------|------|
| **ν”„λ΅μ νΈ κµ¬μ΅°** | 100% | TypeScript + Express + Prisma |
| **λ°μ΄ν„°λ² μ΄μ¤** | 100% | 11κ° λ¨λΈ, λ§μ΄κ·Έλ μ΄μ…, Seed |
| **λ³΄μ• μ‹μ¤ν…** | 100% | μ•”νΈν™”, JWT, κ¶ν•, Rate Limit |
| **μΈμ¦ API** | 100% | 3κ° μ—”λ“ν¬μΈνΈ |
| **μ¶μ„ API** | 100% | 2κ° μ—”λ“ν¬μΈνΈ |
| **ν•™μ› μ •λ³΄ API** | 100% | 2κ° μ—”λ“ν¬μΈνΈ |
| **μ»¤λ¦¬νλΌ API** | 100% | 4κ° μ—”λ“ν¬μΈνΈ |
| **μ»¤λ®¤λ‹ν‹° API** | 100% | 5κ° μ—”λ“ν¬μΈνΈ |
| **μΉκµ¬ μ‹μ¤ν… API** | 100% | 4κ° μ—”λ“ν¬μΈνΈ |
| **μ‚¬μ©μ API** | 100% | 1κ° μ—”λ“ν¬μΈνΈ |
| **Socket.io** | 0% | μ„ νƒ μ‚¬ν•­ (λ―Έκµ¬ν„) |
| **νμΌ μ—…λ΅λ“** | 0% | μ„ νƒ μ‚¬ν•­ (λ―Έκµ¬ν„) |

**λ°±μ—”λ“ μ „μ²΄**: **95% μ™„λ£**  
**μ „μ²΄ ν”„λ΅μ νΈ**: **70% μ™„λ£** (ν”„λ΅ νΈ 90% + λ°±μ—”λ“ 95%, ν†µν•© 0%)

---

## π€ μ„λ²„ μ‹¤ν–‰ λ°©λ²•

### 1. κ°λ° μ„λ²„
```bash
cd backend
npm run dev
```

### 2. ν”„λ΅λ•μ… λΉλ“
```bash
npm run build
npm run start
```

### 3. λ°μ΄ν„°λ² μ΄μ¤ μ΄κΈ°ν™”
```bash
npm run prisma:migrate  # λ§μ΄κ·Έλ μ΄μ…
npm run db:seed         # μ΄κΈ° λ°μ΄ν„°
```

---

## π“ κΈ°λ³Έ κ³„μ •

**κ΄€λ¦¬μ κ³„μ •** (Seedλ΅ μƒμ„±λ¨)
- μ•„μ΄λ””: `admin`
- λΉ„λ°€λ²νΈ: `admin1234`
- νƒκ·Έ: `0000`
- κ¶ν•: Tier 1 (μµκ³  κ΄€λ¦¬μ)

---

## π― λ‹¤μ λ‹¨κ³„

### Phase 3: ν”„λ΅ νΈμ—”λ“ μ—°λ™
1. **ν”„λ΅ νΈμ—”λ“ ν™κ²½ λ³€μ μ„¤μ •**
   ```bash
   # .env.local
   NEXT_PUBLIC_API_URL=http://localhost:3001/api
   NEXT_PUBLIC_SOCKET_URL=http://localhost:3001
   ```

2. **API ν΄λΌμ΄μ–ΈνΈ μ—…λ°μ΄νΈ**
   - `src/lib/api.ts`μ—μ„ μ‹¤μ  λ°±μ—”λ“ νΈμ¶
   - JWT ν† ν° μ €μ¥/κ΄€λ¦¬ (localStorage)

3. **AuthContext μ—°λ™**
   - λ΅κ·ΈμΈ/λ΅κ·Έμ•„μ›ƒ μ‹¤μ  API νΈμ¶
   - ν† ν° κΈ°λ° μΈμ¦ ν”λ΅μ°

4. **λ°μ΄ν„° μ—°λ™ ν…μ¤νΈ**
   - μ¶μ„ μ²΄ν¬ β†’ ν‚¤μ¤μ¤ν¬ νμ΄μ§€
   - μ»¤λ®¤λ‹ν‹° β†’ κ²μ‹κΈ€ λ©λ΅/μ‘μ„±
   - μ»¤λ¦¬νλΌ β†’ κ°•μμ‹¤ νμ΄μ§€

### Phase 4: Socket.io μ‹¤μ‹κ°„ (μ„ νƒ)
1. Socket.io μ„λ²„ μ„¤μ •
2. μ±„ν… λ©”μ‹μ§€ μ‹¤μ‹κ°„ μ „μ†΅
3. μ¶μ„ μ•λ¦Ό μ‹¤μ‹κ°„ μμ‹ 
4. κ²μ‹κΈ€ μ•λ¦Ό

### Phase 5: μ¶”κ°€ κΈ°λ¥ (μ„ νƒ)
1. νμΌ μ—…λ΅λ“ (ν”„λ΅ν•„ μ΄λ―Έμ§€)
2. μ—‘μ…€ λ€λ‰ λ“±λ΅
3. λ°μ΄ν„° λ¶„μ„ λ€μ‹λ³΄λ“
4. κ°μ‚¬ λ΅κ·Έ λ·°μ–΄

---

## π“ μ°Έκ³  λ¬Έμ„

- [BACKEND_DESIGN_PLAN_1_OVERVIEW.md](./BACKEND_DESIGN_PLAN_1_OVERVIEW.md) - μ•„ν‚¤ν…μ²
- [BACKEND_DESIGN_PLAN_2_DATABASE.md](./BACKEND_DESIGN_PLAN_2_DATABASE.md) - DB μ¤ν‚¤λ§
- [BACKEND_DESIGN_PLAN_3_API.md](./BACKEND_DESIGN_PLAN_3_API.md) - API λ…μ„Έ
- [BACKEND_DESIGN_PLAN_4_SECURITY.md](./BACKEND_DESIGN_PLAN_4_SECURITY.md) - λ³΄μ•
- [backend/README.md](./backend/README.md) - λ°±μ—”λ“ μ‚¬μ© κ°€μ΄λ“
- [backend/API_TEST_RESULTS.md](./backend/API_TEST_RESULTS.md) - ν…μ¤νΈ κ²°κ³Ό

---

## β… μµμΆ… μ²΄ν¬λ¦¬μ¤νΈ

### λ°±μ—”λ“
- [x] ν”„λ΅μ νΈ κµ¬μ΅° κµ¬μ¶•
- [x] λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„ λ° λ§μ΄κ·Έλ μ΄μ…
- [x] AES-256 μ•”νΈν™” μ‹μ¤ν…
- [x] JWT μΈμ¦ μ‹μ¤ν…
- [x] Tier κΈ°λ° κ¶ν• μ‹μ¤ν…
- [x] Rate Limiting
- [x] μΈμ¦ API (3κ°)
- [x] μ¶μ„ API (2κ°)
- [x] ν•™μ› μ •λ³΄ API (2κ°)
- [x] μ»¤λ¦¬νλΌ API (4κ°)
- [x] μ»¤λ®¤λ‹ν‹° API (5κ°)
- [x] μΉκµ¬ μ‹μ¤ν… API (4κ°)
- [x] μ‚¬μ©μ API (1κ°)
- [x] API ν…μ¤νΈ
- [x] λ¬Έμ„ν™”

### ν”„λ΅ νΈμ—”λ“
- [x] UI/UX μ™„μ„± (90%)
- [ ] λ°±μ—”λ“ μ—°λ™ (0%)
- [ ] λ°μ΄ν„° ν…μ¤νΈ (0%)

### ν†µν•©
- [ ] ν”„λ΅ νΈ-λ°± μ—°λ™
- [ ] E2E ν…μ¤νΈ
- [ ] λ°°ν¬ μ¤€λΉ„

---

## π‰ κ²°λ΅ 

**λ°±μ—”λ“ ν•µμ‹¬ κΈ°λ¥μ΄ λ¨λ‘ μ™„μ„±**λμ—μµλ‹λ‹¤.

- β… λ³΄μ• μ‹μ¤ν… μ™„λ²½ κµ¬ν„ (μ•”νΈν™”, JWT, κ¶ν•)
- β… 21κ° REST API μ—”λ“ν¬μΈνΈ λ™μ‘
- β… λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„ μ™„λ£
- β… ν…μ¤νΈ μ™„λ£ λ° λ¬Έμ„ν™”

μ΄μ  ν”„λ΅ νΈμ—”λ“μ™€ μ—°λ™ν•μ—¬ **μ „μ²΄ μ‹μ¤ν…μ„ ν†µν•© ν…μ¤νΈ**ν•λ” λ‹¨κ³„λ΅ μ§„ν–‰ν•  μ μμµλ‹λ‹¤.

---

**κ°λ° μ™„λ£μΌ**: 2024-11-20  
**μ„λ²„ μƒνƒ**: β… μ‹¤ν–‰ μ¤‘ (`http://localhost:3001`)  
**λ‹¤μ μ‘μ—…**: ν”„λ΅ νΈμ—”λ“ μ—°λ™
